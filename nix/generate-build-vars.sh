#!/bin/bash

current_dir=$(cd "$(dirname $0)" && pwd)
root_dir=$(cd "$current_dir/.." && pwd)

pushd "${root_dir}" > /dev/null || exit 1;
cat <<NIX >"${current_dir}/build-vars.nix"
# DO NOT EDIT, this file is auto-generated by
# generate-build-vars.sh for purposes of getting around
# the dependency our build has on the .git folder, which is
# not copied to the nix store when building. See the README for
# more details.
{
  imageTag = "$(${root_dir}/tools/image-tag)";
  gitRevision = "$(git rev-parse --short HEAD)";
  gitBranch = "$(git rev-parse --abbrev-ref HEAD)";
}
NIX
popd > /dev/null || exit 1;
