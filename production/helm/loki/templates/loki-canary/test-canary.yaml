{{- with .Values.monitoring.selfMonitoring.lokiCanary.test }}
{{- if .enabled }}
---
apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "loki.name" $ }}-test-canary"
  labels:
    {{- include "loki.labels" $ | nindent 4 }}
    {{- with .labels }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
  annotations:
    {{- with .annotations }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
    "helm.sh/hook": test
spec:
  containers:
    - name: loki-canary-test
      image: {{ include "loki-canary.test-image" $ }}
      args: ['-address', '{{ .prometheusAddress }}']
  restartPolicy: Never
{{- end }}
{{- end }}
